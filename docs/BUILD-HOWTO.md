# Build and Install Instructions for Lustre Sentinel

This document provides step-by-step instructions to build and install the Lustre changelog consumer tool, which processes Lustre filesystem changelogs, stores them in a DuckDB database, and tracks operation type, time, client NID, UID/GID, and full path. The tool uses Autoconf and Automake for a standard build process.

The project includes two main executables:
- `lsentineld`: The daemon or single-shot tool for consuming and processing Lustre changelogs.
- `sentinel`: A query tool for retrieving file history from the DuckDB databases generated by `lsentineld`.

## Prerequisites

Before building, ensure the following dependencies are installed:

- **Lustre Client Libraries**: Required for `liblustreapi` (e.g., `lustre-client-devel` on RHEL-based systems).
- **DuckDB**: Required for `libduckdb` (e.g., `duckdb-devel`).
- **C Compiler**: A C compiler like `gcc`.
- **Build Tools**: Autoconf, Automake, and Libtool for generating build files.
- **Operating System**: A Linux system with Lustre client support (e.g., RHEL, Ubuntu).

### Installing Dependencies

On a RHEL-based system (e.g., CentOS, Rocky Linux):
```bash
sudo yum install lustre-client-devel duckdb-devel gcc autoconf automake libtool
```

On a Debian-based system (e.g., Ubuntu):
```bash
sudo apt-get install lustre-dev libduckdb-dev gcc autoconf automake libtool
```

Note: Package names may vary depending on your distribution and version. If DuckDB is not available in your package manager, you may need to build it from source. See the [DuckDB documentation](https://duckdb.org/docs/installation) for details.

## Project Structure

Ensure the following files are present in the project directory:
```
lustre-sentinel/
├── aclocal.m4
├── compile
├── config.h.in
├── configure
├── configure.ac
├── depcomp
├── docs/
│   ├── ABOUT.md
│   ├── BUILD-HOWTO.md
│   ├── README.md
│   └── TESTING.md
├── install-sh
├── LICENSE.txt
├── Makefile.am
├── Makefile.in
├── missing
├── src/
│   ├── lsentineld.1
│   ├── lsentineld.c
│   ├── Makefile.am
│   ├── Makefile.in
│   ├── sentinel.1
│   └── sentinel.c
└── tests/
    ├── simulate_activity.sh
    └── test-sentinel.sh
```

Note: Some files (e.g., `aclocal.m4`, `compile`, `config.h.in`, `configure`, `depcomp`, `install-sh`, `Makefile.in`, `missing`) are generated during the build process if not already present.

## Building the Tool

Follow these steps to build the tool:

1. **Generate the Configure Script**:
   Run `autoreconf` to create the `configure` script and other build files:
   ```bash
   autoreconf --install
   ```
   This command requires Autoconf, Automake, and Libtool. If it fails, ensure these tools are installed.

2. **Configure the Build**:
   Run the `configure` script to check for dependencies and generate Makefiles:
   ```bash
   ./configure
   ```
   Optional: Specify a custom installation prefix (default is `/usr/local`):
   ```bash
   ./configure --prefix=/usr
   ```

   If dependencies are missing (e.g., `liblustreapi` or `libduckdb`), the script will exit with an error message. Install the missing packages and retry.

3. **Build the Executables**:
   Compile the source code:
   ```bash
   make
   ```
   This will build `lsentineld` and `sentinel` in the `src/` directory.

4. **Install the Tool**:
   Install the executables and man pages to the system (requires root privileges):
   ```bash
   sudo make install
   ```
   This installs:
   - Binaries to `/usr/local/bin/` (or the specified prefix).
   - Man pages (`lsentineld.1` and `sentinel.1`) to `/usr/local/share/man/man1/`.

## Post-Installation

After installation:
- Verify the installation by running `lsentineld --help` and `sentinel --help`.
- Refer to `README.md` for usage instructions on running `lsentineld` (e.g., in daemon mode or for consumer registration) and `sentinel` (e.g., for querying file histories).
- For design details, see `ABOUT.md`.
- For testing, refer to `TESTING.md` and run scripts in the `tests/` directory (requires a Lustre filesystem setup).

If you encounter issues during building, check `config.log` for detailed error messages. Ensure your system has Lustre mounted and accessible for testing the tools.
