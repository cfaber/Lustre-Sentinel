.TH SENTINEL 1 "December 28, 2025" "Lustre Sentinel 1.0"
.SH NAME
sentinel \- DuckDB client to query Lustre Sentinel databases for file history
.SH SYNOPSIS
.B sentinel
[options] (\fB--fid\fR \fI<fid>\fR | \fB--path\fR \fI<path>\fR | \fB--search\fR \fI<term>\fR)
.SH DESCRIPTION
.B sentinel
queries multiple DuckDB databases generated by Lustre Sentinel to construct the operation history for a given file identified by FID or path. It can also search for terms in file paths across databases.

Databases are opened read-only. If a database is locked (e.g., active by the consumer), it is skipped.

The tool supports querying via two methods: \fBloop\fR (iterating over databases individually) or \fBattach\fR (attaching all databases to a single connection). It resolves paths using Lustre APIs or database fallbacks, handles UTF-8 validation, and outputs in various formats.

For FID or path queries, it retrieves and sorts the history of operations (e.g., CREAT, UNLNK, RENME) including timestamps, UIDs/GIDs, client NIDs, and full paths.

For search mode, it scans the \fBchangelog\fR table for matches in \fBfull_path\fR.

The tool can load settings from a configuration file (key=value format, e.g., "format=text").
.SH OPTIONS
.TP
.B --db-path \fI<dir>\fR
Directory to search for databases (default: current directory).
.TP
.B --db-template \fI<tmpl>\fR
Database file template (e.g., "sentinel_%02d.db"). Used for pattern-based discovery.
.TP
.B --db-glob \fI<glob>\fR
Glob pattern for database files (e.g., "*.db"). Overrides template if specified.
.TP
.B --db-files \fI<file1> [<file2>...]\fR
Explicit list of database files to query.
.TP
.B --format \fI<text|json|yaml|csv|fancy>\fR
Output format (default: text). "fancy" provides a formatted table-like output.
.TP
.B --method \fI<attach|loop>\fR
Query method (default: loop). "attach" may be faster for many databases but requires more memory.
.TP
.B --config \fI<file>\fR
Configuration file to load options from (key=value pairs).
.TP
.B --output \fI<file>\fR
Output file (default: stdout). If specified, results are written to this file.
.TP
.B -v, --verbose
Increase verbosity (repeat for higher levels, up to detailed debugging).
.TP
.B -h, --help
Show help message and exit.
.SH SEARCH MODE OPTIONS
These apply when using \fB--search\fR:
.TP
.B --search \fI<term>\fR
Search term to find in full_path across databases.
.TP
.B --regex
Use regex matching for the search (default: keyword/literal match).
.SH EXAMPLES
Query history by FID:
.PP
.RS
sentinel --fid [0x200000007:0x1:0x0] --db-path /path/to/dbs --format json
.RE
.PP
Query history by path:
.PP
.RS
sentinel --path /lustre/file.txt --db-glob "*.db" --verbose
.RE
.PP
Search for a term:
.PP
.RS
sentinel --search "secret" --db-path /dbs --regex --format csv --output results.csv
.RE
.SH FILES
Databases typically follow patterns like "sentinel_%02d.db" as generated by lsentineld(1).
.SH DIAGNOSTICS
Exits with 0 on success, 1 on error. Verbose output includes details on skipped databases, query methods, and path resolutions.
.SH AUTHORS
Colin Faber <cfaber@thelustrecollective.com>
.SH SEE ALSO
.BR lsentineld (1)
